<?xml version="1.0" encoding="UTF-8"?>
<order>
  <id>12</id>
  <name>test</name>
  <email>sr@zestvisual.com</email>
  <phone>123 123 </phone>
  <comment>123 12 312 </comment>
  <city>123123</city>
  <ordered_m>
    <ring_original>
      <name_ru>Согласие Тайна рассвета</name_ru>
      <name_ua>Злагода Таємниця світанку</name_ua>
      <articul>0001507</articul>
      <size>19</size>
      <gender>m</gender>
      <width>7</width>
      <height>0</height>
      <koeff>5.005</koeff>
      <weight>8.48</weight>
      <thickness>2.3</thickness>
      <price>10880</price>
      <remote_id>00013EOF </remote_id>
      <active_st_size>0</active_st_size>
      <collection>
        <id>1</id>
        <id_for_ring>1</id_for_ring>
        <name_ua>Злагода</name_ua>
        <name_ru>Согласие</name_ru>
        <formula>$knk = 5.005;&#13;
$original_cost_stones = 0;&#13;
$selected_cost_stones = 0;&#13;
$original_weight_stones = 0;&#13;
$original_ring_cost_metal = 0;&#13;
$select_ring_cost_metal = 0;&#13;
&#13;
if(isset($ring_info_m['ring_original']))&#13;
{&#13;
//------------------------------------------------------------&#13;
//$original_cost_stones - стоимость вставки&#13;
if($ring_info_m['ring_original']['stones'])&#13;
{&#13;
foreach($ring_info_m['ring_original']['stones'] as $stone)&#13;
{&#13;
$original_cost_stones += $stone['count'] * $stone['price'] * $stone['karatnost'];&#13;
$original_weight_stones += $stone['count'] * $stone['karatnost'] /5;&#13;
&#13;
}&#13;
$original_cost_stones = $original_cost_stones * $knk;&#13;
}&#13;
else&#13;
{&#13;
	$original_cost_stones = 0;&#13;
	$original_weight_stones = 0;&#13;
}&#13;
//------------------------------------------------------------&#13;
//$selected_cost_stones - стоимость выбранной вставки&#13;
if($ring_info_m['selected_stones'])&#13;
{&#13;
 foreach($ring_info_m['selected_stones']['size'] as $stone)&#13;
{&#13;
  foreach($stone as $s)&#13;
{&#13;
  $selected_cost_stones += $s['karatnost'] * $s['price'] * $s['count'];&#13;
$stone_type = $s['color_ru'];&#13;
&#13;
}&#13;
$selected_cost_stones = $selected_cost_stones * $knk;&#13;
}&#13;
}&#13;
else&#13;
{&#13;
    $selected_cost_stones = $original_cost_stones;&#13;
   &#13;
}&#13;
&#13;
//стоимость оригинального метала&#13;
switch($ring_info_m['ring_original']['metal']['probe']) {&#13;
		case '585': $cost_metal = 30; $koef_metal = 1; $koef_oncost = 5.005; break;&#13;
		case '950': $cost_metal = 65; $koef_metal = 1.52; $koef_oncost = 5.005; break;&#13;
		case '850': $cost_metal = 23; $koef_metal = 0.83; $koef_oncost = 7; break; &#13;
		case '750': $cost_metal = 40; $koef_metal = 1.2; $koef_oncost = 5.005; break; &#13;
	}&#13;
$original_ring_cost_metal = ($ring_info_m['ring_original']['weight'] - $original_weight_stones) * $cost_metal * $koef_metal * $koef_oncost;	&#13;
$original_ring_cost_metal = ceil($original_ring_cost_metal/10)*10*8.5;&#13;
//------------------------------------------------------------&#13;
//стоимость выбранного метала&#13;
if($ring_info_m['selected_metal'])&#13;
	{&#13;
	switch($ring_info_m['selected_metal']['probe']) {&#13;
		case '585': $cost_metal = 30; $koef_metal = 1; $koef_oncost = 5.005; break;&#13;
		case '950': $cost_metal = 65; $koef_metal = 1.52; $koef_oncost = 5.005; break;&#13;
		case '850': $cost_metal = 23; $koef_metal = 0.83; $koef_oncost = 7; break; // не забыть поделить наценку&#13;
		case '750': $cost_metal = 40; $koef_metal = 1.2; $koef_oncost = 5.005; break;&#13;
		&#13;
	}	&#13;
$select_ring_cost_metal = ($ring_info_m['ring_original']['weight'] - $original_weight_stones)* $cost_metal * $koef_metal * $koef_oncost;&#13;
$select_ring_cost_metal = ceil($select_ring_cost_metal/10)*10*8.5;&#13;
	}&#13;
else&#13;
{&#13;
   $select_ring_cost_metal = $original_ring_cost_metal;&#13;
}&#13;
//------------------------------------------------------------&#13;
//ФОРМУЛА&#13;
if($ring_info_m['ring_original']['active_st_size'])&#13;
{&#13;
	if(!$ring_info_m['selected_stones'])&#13;
	{&#13;
		$new_price_m = ($ring_info_m['ring_original']['price'] - $original_ring_cost_metal + $select_ring_cost_metal)* $ring_info_m['selected_size']/$ring_info_m['ring_original']['size'];&#13;
	}&#13;
	else&#13;
	{&#13;
		if($stone_type === 'Белый')&#13;
		{&#13;
		$new_price_m = (($ring_info_m['ring_original']['price'] - $original_ring_cost_metal) + $select_ring_cost_metal)* $ring_info_m['selected_size']/$ring_info_m['ring_original']['size'];&#13;
		}&#13;
		else&#13;
		{&#13;
		$new_price_m = ($selected_cost_stones + $select_ring_cost_metal)* $ring_info_m['selected_size']/$ring_info_m['ring_original']['size'];&#13;
		}&#13;
	}&#13;
}&#13;
else&#13;
{&#13;
	if(!$ring_info_m['selected_stones'])&#13;
	{&#13;
		$new_price_m = $select_ring_cost_metal * $ring_info_m['selected_size']/$ring_info_m['ring_original']['size'] + ($ring_info_m['ring_original']['price'] - $original_ring_cost_metal);&#13;
	}&#13;
        else&#13;
        {&#13;
		if($stone_type === 'Белый')&#13;
		{&#13;
		$new_price_m = $select_ring_cost_metal * $ring_info_m['selected_size']/$ring_info_m['ring_original']['size'] + ($ring_info_m['ring_original']['price'] - $original_ring_cost_metal);&#13;
&#13;
		}&#13;
		else&#13;
		{&#13;
		$new_price_m = $select_ring_cost_metal * $ring_info_m['selected_size']/$ring_info_m['ring_original']['size'] + $selected_cost_stones;&#13;
&#13;
		}&#13;
	}&#13;
}&#13;
&#13;
&#13;
&#13;
}&#13;
&#13;
&#13;
&#13;
&#13;
if(isset($ring_info_w['ring_original']))&#13;
{&#13;
   &#13;
//------------------------------------------------------------&#13;
&#13;
&#13;
//$original_cost_stones - стоимость вставки&#13;
if($ring_info_w['ring_original']['stones'])&#13;
{&#13;
foreach($ring_info_w['ring_original']['stones'] as $stone)&#13;
{&#13;
$original_cost_stones += $stone['count'] * $stone['price'] * $stone['karatnost'];&#13;
$original_weight_stones += $stone['count'] * $stone['karatnost'] /5;&#13;
&#13;
}&#13;
$original_cost_stones = $original_cost_stones * $knk;&#13;
}&#13;
else&#13;
{&#13;
	$original_cost_stones = 0;&#13;
	$original_weight_stones = 0;&#13;
}&#13;
//------------------------------------------------------------&#13;
//$selected_cost_stones - стоимость выбранной вставки&#13;
if($ring_info_w['selected_stones'])&#13;
{&#13;
 foreach($ring_info_w['selected_stones']['size'] as $stone)&#13;
{&#13;
  foreach($stone as $s)&#13;
{&#13;
  $selected_cost_stones += $s['karatnost'] * $s['price'] * $s['count'];&#13;
$stone_type = $s['color_ru'];&#13;
&#13;
}&#13;
$selected_cost_stones = $selected_cost_stones * $knk;&#13;
}&#13;
}&#13;
else&#13;
{&#13;
    $selected_cost_stones = $original_cost_stones;&#13;
   &#13;
}&#13;
&#13;
//стоимость оригинального метала&#13;
switch($ring_info_w['ring_original']['metal']['probe']) {&#13;
		case '585': $cost_metal = 30; $koef_metal = 1; $koef_oncost = 5.005; break;&#13;
		case '950': $cost_metal = 65; $koef_metal = 1.52; $koef_oncost = 5.005; break;&#13;
		case '850': $cost_metal = 23; $koef_metal = 0.83; $koef_oncost = 7; break; &#13;
		case '750': $cost_metal = 40; $koef_metal = 1.2; $koef_oncost = 5.005; break; &#13;
	}&#13;
$original_ring_cost_metal = ($ring_info_w['ring_original']['weight'] - $original_weight_stones) * $cost_metal * $koef_metal * $koef_oncost;	&#13;
$original_ring_cost_metal = ceil($original_ring_cost_metal/10)*10*8.5;&#13;
//------------------------------------------------------------&#13;
//стоимость выбранного метала&#13;
if($ring_info_w['selected_metal'])&#13;
	{&#13;
	switch($ring_info_w['selected_metal']['probe']) {&#13;
		case '585': $cost_metal = 30; $koef_metal = 1; $koef_oncost = 5.005; break;&#13;
		case '950': $cost_metal = 65; $koef_metal = 1.52; $koef_oncost = 5.005; break;&#13;
		case '850': $cost_metal = 23; $koef_metal = 0.83; $koef_oncost = 7; break; // не забыть поделить наценку&#13;
		case '750': $cost_metal = 40; $koef_metal = 1.2; $koef_oncost = 5.005; break;&#13;
		&#13;
	}	&#13;
$select_ring_cost_metal = ($ring_info_w['ring_original']['weight'] - $original_weight_stones)* $cost_metal * $koef_metal * $koef_oncost;&#13;
$select_ring_cost_metal = ceil($select_ring_cost_metal/10)*10*8.5;&#13;
	}&#13;
else&#13;
{&#13;
   $select_ring_cost_metal = $original_ring_cost_metal;&#13;
}&#13;
//------------------------------------------------------------&#13;
//ФОРМУЛА&#13;
if($ring_info_w['ring_original']['active_st_size'])&#13;
{&#13;
	if(!$ring_info_w['selected_stones'])&#13;
	{&#13;
		$new_price_w = ($ring_info_w['ring_original']['price'] - $original_ring_cost_metal + $select_ring_cost_metal)* $ring_info_w['selected_size']/$ring_info_w['ring_original']['size'];&#13;
	}&#13;
	else&#13;
	{&#13;
		if($stone_type === 'Белый')&#13;
		{&#13;
		$new_price_w = (($ring_info_w['ring_original']['price'] - $original_ring_cost_metal) + $select_ring_cost_metal)* $ring_info_w['selected_size']/$ring_info_w['ring_original']['size'];&#13;
		}&#13;
		else&#13;
		{&#13;
		$new_price_w = ($selected_cost_stones + $select_ring_cost_metal)* $ring_info_w['selected_size']/$ring_info_w['ring_original']['size'];&#13;
		}&#13;
	}&#13;
}&#13;
else&#13;
{&#13;
	if(!$ring_info_w['selected_stones'])&#13;
	{&#13;
		$new_price_w = $select_ring_cost_metal * $ring_info_w['selected_size']/$ring_info_w['ring_original']['size'] + ($ring_info_w['ring_original']['price'] - $original_ring_cost_metal);&#13;
	}&#13;
        else&#13;
        {&#13;
		if($stone_type === 'Белый')&#13;
		{&#13;
		$new_price_w = $select_ring_cost_metal * $ring_info_w['selected_size']/$ring_info_w['ring_original']['size'] + ($ring_info_w['ring_original']['price'] - $original_ring_cost_metal);&#13;
&#13;
		}&#13;
		else&#13;
		{&#13;
		$new_price_w = $select_ring_cost_metal * $ring_info_w['selected_size']/$ring_info_w['ring_original']['size'] + $selected_cost_stones;&#13;
&#13;
		}&#13;
	}&#13;
}&#13;
}</formula>
      </collection>
      <metal>
        <id>1</id>
        <name_ua>золото</name_ua>
        <name_ru>золото</name_ru>
        <name_short>YP</name_short>
        <probe>585</probe>
      </metal>
      <surface>
        <id>1</id>
        <name_ua>полірована</name_ua>
        <name_ru>полированная</name_ru>
      </surface>
      <enamel>
        <id>1</id>
        <name_ua>чорна</name_ua>
        <name_ru>черная</name_ru>
      </enamel>
    </ring_original>
  </ordered_m>
</order>
